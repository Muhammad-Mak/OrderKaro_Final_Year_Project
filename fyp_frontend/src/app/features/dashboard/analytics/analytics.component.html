<h2>Dashboard Analytics</h2>

<section class="analytics-cards">
  <div class="card">
    <h3>Total Orders</h3>
    <p>{{ totalOrders }}</p>
  </div>
  <div class="card">
    <h3>Total Revenue</h3>
    <p>{{ totalRevenue | currency:'PKR' }}</p>
  </div>
</section>

<section class="top-items">
  <h3>Top 6 Ordered Items</h3>
  <table>
    <thead>
      <tr><th>Item</th><th>Order Count</th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of topItems">
        <td>{{ item.name }}</td>
        <td>{{ item.orderCount }}</td>
      </tr>
    </tbody>
  </table>
</section>

<section class="users">
  <h3>Users</h3>
  <table>
    <thead>
      <tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>
          <div *ngIf="editUser?.userId !== user.userId">{{ user.firstName }} {{ user.lastName }}</div>
          <div *ngIf="editUser?.userId === user.userId">
            <input [(ngModel)]="editUser.firstName" placeholder="First" />
            <input [(ngModel)]="editUser.lastName" placeholder="Last" />
          </div>
        </td>
        <td>
          {{ user.email }}
        </td>
        <td>
          <div *ngIf="editUser?.userId !== user.userId">{{ user.role }}</div>
          <div *ngIf="editUser?.userId === user.userId">
            <select [(ngModel)]="editUser.role">
              <option value="Customer">Customer</option>
              <option value="Admin">Admin</option>
              <option value="Staff">Staff</option>
            </select>
          </div>
        </td>
        <td>
          <div *ngIf="editUser?.userId !== user.userId">
            <button (click)="selectUser(user)">View Orders</button>
            <button (click)="edit(user)">Edit</button>
            <button (click)="confirmDelete(user)">Delete</button>
          </div>
          <div *ngIf="editUser?.userId === user.userId">
            <button (click)="saveEdit()">Save</button>
            <button (click)="cancelEdit()">Cancel</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</section>

<section *ngIf="selectedUser">
  <h4>Orders by {{ selectedUser.firstName }}</h4>
  <table>
    <thead>
      <tr><th>Order #</th><th>Status</th><th>Total</th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of userOrders">
        <td>{{ order.orderNumber }}</td>
        <td>{{ order.status }}</td>
        <td>{{ order.totalAmount | currency:'PKR' }}</td>
      </tr>
    </tbody>
  </table>
</section>

<section class="all-orders">
  <h3>All Orders</h3>
  <table>
    <thead>
      <tr><th>Order #</th><th>User</th><th>Status</th><th>Total</th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of allOrders">
        <td>{{ order.orderNumber }}</td>
        <td>{{ order.firstName ?? 'N/A' }} {{ order.lastName ?? '' }}</td>
        <td>{{ order.status }}</td>
        <td>{{ order.totalAmount | currency:'PKR' }}</td>
      </tr>
    </tbody>
  </table>
</section>
